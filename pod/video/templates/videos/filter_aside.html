{% load i18n %}
{% load tagging_tags %}
{% spaceless %}
<div class="card card-body">
<h4 class="card-title">
<svg height="32" class="octicon octicon-settings" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M4 7H3V2h1v5zm-1 7h1v-3H3v3zm5 0h1V8H8v6zm5 0h1v-2h-1v2zm1-12h-1v6h1V2zM9 2H8v2h1V2zM5 8H2c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1zm5-3H7c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1zm5 4h-3c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1z"></path></svg>{% trans "Filters"%}</h4>
<p class="card-text">
    <form action="{% url 'videos' %}" method="get" id="filters">
    <fieldset>
    <legend  class="h5"> {% trans "Users" %}</legend>
    <div class="form-group">
        <input placeholder="{% trans "Search" %}" id="ownerbox" type="text" class="form-control">
    </div>
    <div class="form-group navList owners" id="collapseFilterOwner">
        {% for owner in OWNERS %}
        {% if owner.username in owners %}
        <div class="form-check">
        <input class="form-check-input" type="checkbox" name="owner" value="{{owner.username}}" id="id{{owner.username}}"checked>
        <label class="form-check-label" for="id{{owner.username}}">
            {{owner.first_name}} {{owner.last_name}} ({{owner.username}})
        </label>
        </div>
        {% endif %}
        {% endfor %}  
    </div>
    </fieldset>
    
    <button type="submit" class="btn btn-link">&gt;&gt;{% trans "Filter"%}</button>

    <fieldset class="border-right border-bottom">
    <legend class="h5"> {% trans "Types"%}</legend>
    <div id="filterType">
    <div class="form-group collapse" id="collapseFilterType">
    {% for type in TYPES %}
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="type" 
          value="{{type.slug}}" id="id{{type.slug}}" {% if type.slug in types %}checked{% endif %}>
          <label class="form-check-label" for="id{{type.slug}}">
            {{type}}
          </label>
        </div>
    {%endfor%}
    </div>
    {% if TYPES.count > 5 %}
    <span class="badge badge-light float-right"><a class="collapsed" data-toggle="collapse" href="#collapseFilterType" aria-expanded="false" aria-controls="collapseFilterType"></a></span>
    {% endif %}
    </div><!-- type -->
    </fieldset>
    
    <button type="submit" class="btn btn-link">&gt;&gt;{% trans "Filter"%}</button>
    
    <fieldset class="border-right border-bottom">
    <legend class="h5">{% trans "Disciplines"%}</legend>
    <div id="filterDiscipline">
    <div class="form-group collapse" id="collapseFilterDiscipline">
    {% for discipline in DISCIPLINES %}
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="discipline" 
          value="{{discipline.slug}}" id="id{{discipline.slug}}" {% if discipline.slug in disciplines %}checked{% endif %}>
          <label class="form-check-label" for="id{{discipline.slug}}">
            {{discipline}}
          </label>
        </div>
    {%endfor%}
    </div>
    {% if DISCIPLINES.count > 5 %}
    <span class="badge badge-light float-right"><a class="collapsed" data-toggle="collapse" href="#collapseFilterDiscipline" aria-expanded="false" aria-controls="collapseFilterDiscipline"></a></span>
    {% endif %}
    </div><!-- filterdiscipline -->
    </fieldset>

    <button type="submit" class="btn btn-link">&gt;&gt;{% trans "Filter"%}</button>

    <fieldset class="border-right border-bottom">
    <legend class="h5">{% trans "Tags"%}</legend>
    <div id="filterTag">
    <div class="form-group collapse" id="collapseFilterTag">
    {% tags_for_model video.Video as tagscloud with counts %}
    {% with tagslist=tagscloud|dictsortreversed:"count"|slice:":20" %}
    {% for tag in tagslist %}
    <div class="form-check">
      <input class="form-check-input" type="checkbox" name="tag" 
      value="{{tag.name}}" id="id{{tag.name}}" {% if tag.name in tags_slug %}checked{% endif %}>
      <label class="form-check-label" for="id{{tag.name}}">
        {{tag.name}}
      </label>
    </div>
    {% endfor %}
    </div>
    {% if tagslist|length > 5 %}
    <span class="badge badge-light float-right"><a class="collapsed" data-toggle="collapse" href="#collapseFilterTag" aria-expanded="false" aria-controls="collapseFilterTag"></a></span>
    {% endif %}
    {% endwith %}
    </div>
    </fieldset>
    <button type="submit" class="btn btn-link">&gt;&gt;{% trans "Filter"%}</button>
    </form>
</p>
</div>
<script>
var listUserChecked = {{owners|safe}};
$('#ownerbox').keyup(function() {
  if($(this).val() && $(this).val().length > 2) {
    var valThis = $(this).val().toLowerCase();
    var letter = valThis.charAt(0);
    var nbuser = listUser[letter].length;
    /*$("#accordion").html("");*/
    $("#collapseFilterOwner .added").prop('checked', false).remove();
    for(i=0; i<nbuser; i++) {
      var lastname = listUser[letter][i]["last_name"].toLowerCase();
      if(lastname.indexOf(valThis) != -1 && listUserChecked.indexOf(listUser[letter][i]["username"])==-1 ) {
        var chekboxhtml = '<div class="form-check added"><input class="form-check-input" type="checkbox" name="owner" value="'+listUser[letter][i]["username"]+'" id="id'+listUser[letter][i]["username"]+'"><label class="form-check-label" for="id'+listUser[letter][i]["username"]+'">'+listUser[letter][i]["first_name"]+' '+listUser[letter][i]["last_name"]+' ('+listUser[letter][i]["username"]+')</label></div>';
        $("#collapseFilterOwner").append(chekboxhtml);
      }
    }
  } else {
    $("#collapseFilterOwner .added").prop('checked', false).remove();
  }
});
</script>
{% endspaceless %}