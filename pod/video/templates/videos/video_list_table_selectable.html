{% load i18n %}
{% load static %}
{% load favorites_playlist %}
{% load playlist_buttons %}
{% spaceless %}

<ul id="videos_list" class="infinite-container infinite-container-selectable list-group list-group-action" data-nextpage="{{ videos.has_next|yesno:'true,false' }}" data-countvideos="{{ count_videos }}">
  {% for video in videos %}
  <div class="row mt-3">
      <li id="list-group-item-row" class="infinite-item list-group-item d-flex align-items-center" data-slug={{video.slug}} onclick="toggleSelectedVideo(this)">
        {% include "videos/video_row_select.html" %}
      </li>
        <div id="more-btn-group" class="btn-group ms-auto" role="group">
            <button id="btn-more-actions-video-{{ video.id }}" type="button" class="btn-more-actions-video-row"
                    data-bs-toggle="dropdown" aria-expanded="false" title="{% trans 'More' %}">
                <i class="bi bi-three-dots bi_more" aria-hidden="true"></i>
            </button>
            <ul class="dropdown-menu" aria-labelledby="btn-more-actions-video-{{ video.id }}">
                <li><a href="{% url 'video:video' video.slug %}" title="{% trans "Play" %}" aria-hidden="true"
                       class="dropdown-item">{% trans "Play" %}</a></li>
                {% if playlist %}
                    {% user_can_edit_or_remove playlist as can_edit_or_remove %}
                    {% if not in_favorites_playlist and can_edit_or_remove %}
                        <li><a href="{% url 'playlist:remove-video' playlist.slug video.slug %}"
                               title="{% trans "Remove from playlist" %}" class="dropdown-item"
                               id="remove-from-playlist-btn-{{ video.id }}">{% trans "Remove from playlist" %}</a></li>
                    {% endif %}
                {% endif %}
                {{ is_favorite }}
                {% is_favorite user video as is_favorite %}
                {% get_favorite_playlist user as fav_playlist %}
                {% if USE_PLAYLIST and USE_FAVORITES and video.is_draft is False and not hide_favorite_link is True %}
                    <li>
                        {% if is_favorite %}
                            <a href="{% url 'playlist:remove-video' fav_playlist.slug video.slug %}"
                               title="{% trans "Remove from favorite" %}" class="dropdown-item"
                               id="favorite-btn-{{ video.id }}" aria-pressed="true"
                               role="button">{% trans "Remove from favorite" %}</a>
                        {% else %}
                            <a href="{% url 'playlist:add-video' fav_playlist.slug video.slug %}"
                               title="{% trans "Add in favorite" %}" class="dropdown-item" id="favorite-btn-{{ video.id }}"
                               aria-pressed="false" role="button">{% trans "Add in favorite" %}</a>
                        {% endif %}
                    </li>
                {% endif %}
                {% if video.owner == request.user or request.user.is_superuser or request.user in video.additional_owners.all or perms.video.change_video %}
                    <li>
                        <a href="{% url 'video:video_edit' slug=video.slug %}" title="{% trans 'Edit the video' %}"
                           class="dropdown-item">{% trans 'Edit the video' %}</a>
                    </li>
                {% endif %}
                {% if video.owner == request.user or request.user.is_superuser or request.user in video.additional_owners.all or perms.completion.add_contributor or perms.completion.add_track or perms.completion.add_document or perms.completion.add_overlay %}
                    <li>
                        <a href="{% url 'video:completion:video_completion' slug=video.slug %}"
                           title="{% trans 'Complete the video' %}"
                           class="dropdown-item">{% trans 'Complete the video' %}</a>
                    </li>
                {% endif %}
                {% if video.encoded and video.encoding_in_progress is False %}
                    {% if video.owner == request.user or request.user.is_superuser or perms.cut.cut_video %}
                        <li>
                            <a href="{% url 'video:cut:video_cut' slug=video.slug %}" title="{% trans 'Cut the video' %}"
                               aria-hidden="true" class="dropdown-item">{% trans 'Cut the video' %}</a>
                        </li>
                    {% endif %}
                {% endif %}
                {% if video.owner == request.user or request.user.is_superuser or request.user in video.additional_owners.all or perms.chapter.change_chapter %}
                    <li>
                        <a href="{% url 'video:chapter:video_chapter' slug=video.slug %}"
                           title="{% trans 'Chapter the video' %}" class="dropdown-item">{% trans 'Chapter the video' %}</a>
                    </li>
                {% endif %}
                {% if video.encoded and video.encoding_in_progress is False %}
                    {% if video.owner == request.user or request.user.is_superuser or perms.video.delete_video %}
                        <li>
                            <a href="{% url 'video:video_delete' slug=video.slug %}" class="dropdown-item"
                               title="{% trans 'Delete the video' %}">{% trans 'Delete the video' %}</a>
                        </li>
                    {% endif %}
                {% endif %}
            </ul>
        </div>
    </div>
  {% empty %}
  <div>
    <p>{% trans "Sorry, no video found." %}</p>
  </div>
  {% endfor %}
</ul>

{% if videos.has_next %}
  <a
    style = "display:none"
    class="infinite-more-link"
    href="{{ full_path }}{% if '?' in full_path %}&{% else %}?{% endif %}page={{ videos.next_page_number }}"
    data-nextpagenumber = "{% if videos.has_next %}{{ videos.next_page_number }}{% else %}null{% endif %}" >{% trans "More" %}
  </a>
{% endif %}

<div class="infinite-loading" style="display: none;">
  {% trans "Loading..." %}
</div>
{% endspaceless %}
<script defer src="{% static 'js/video_select.js' %}"></script>
