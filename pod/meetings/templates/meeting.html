{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block more_style %}
<!-- a retirer -->
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<!-- 
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script> 
-->
{% endblock more_style %}

{% block breadcrumbs %}{{ block.super }} <li class="breadcrumb-item active" aria-current="page">{% trans "My meetings" %}</li>{% endblock %}

{% block page_title %}
    {% trans "My meetings" %}   
{% endblock %}


{% block page_content %}

<h2 class="h4">{% trans "Meetings"%}</h2>

<div >
    <!-- a déplacer dans la barre de menu ?-->
    <a id="button" class="btn btn-sm pod-add-meeting btn-primary" href="{% url 'meetings:create' %}">{% trans "Add"%}</a>
</div>

<br>

<div class="#">
    <!-- <input class="form-control" id="myInput" type="text" placeholder="Search.."> -->
    <table with="600" class="table table-bordered table-striped" style="border-collapse: collapse;">
        <thead>
            <tr>
                <!-- a traduire -->
                <td>{% trans "Title"%}</td><td>{% trans "Start"%}</td><td>{% trans "End"%}</td>
            </tr>
        </thead>
        <tbody>
            {% for element in dataMeetings %}
            <tr>
                <td> {{ element.name }} </td>
                <td> {{ element.start_date }} </td>
                <td> {{ element.end_date }} </td>
                <td><a class="btn btn-success" href="{% url 'meetings:edit' element.meetingID %}">{% trans "Modify"%}</a>
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-danger btn-delete-meeting" data-bs-toggle="modal" data-bs-target="#delete-meeting-modal" data-meeting-id="meeting-{{element.id}}" data-action="{% url 'meetings:delete' element.meetingID %}">
                        {% trans "Delete"%}
                    </button>
                <br></br>
                <p>{% trans "Link"%} 
                    <span>
                    <input type="text" value="{% if request.is_secure %}https{% else %}http{% endif %}://{{ request.META.HTTP_HOST }}{% url 'meetings:join' element.meetingID %}" />
                    <button type="button" class="bi bi-files btn btn-join-meeting"></button>
                    </span>
                    <a class="btn btn-info" href="{% url 'meetings:join' element.meetingID %}">{% trans "Join"%}</a>
                </p>
                </td>
                <td>{% if element.is_running == 'true' %}<span class="btn btn-outline-success">{% trans "Running" %}</span>{% else %}<span class="btn btn-outline-danger">{% trans "Not running" %}</span>{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<!-- Modal -->
<div class="modal fade" id="delete-meeting-modal" tabindex="-1" aria-labelledby="deleteItemLabel" aria-hidden="true">
    <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" id="deleteItemLabel">{% trans "Are you sure you want to delete ?" %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form method="POST" id="delete-item">
                {% csrf_token %}
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                <input class="btn btn-danger" type="submit" value="{% trans "Delete" %}">
            </form>
        </div>
    </div>
    </div>
</div>
{% endblock page_content %}

{% block more_script %}

<script>
    $(".btn-join-meeting").click(function ()  {
        /* Get the text field */
        //var copyText = document.getElementById("copy");
        let copyText = $(this).prev()[0];
        /* Select the text field */
        copyText.select();
        copyText.setSelectionRange(0, 99999); /* For mobile devices */
        /* Copy the text inside the text field */
        navigator.clipboard.writeText(copyText.value);
        /* Alert the copied text */
        alert("Copied the text: " + copyText.value);
    });
    // au chargement de la modal, renseigner le champ action du formulaire de la modal avec la valeur du champ data-action du bouton ayant été cliqué.
    $(".btn-delete-meeting").on("click", function() {
        $("#delete-item").attr("action", $(this).attr("data-action"));
    });

</script>
{% endblock more_script %}

